
const que = [
  {"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"これからまたお便りします。おげんきで。","AnswerJP1":"おたより","AnswerJP2":"おあずかり","AnswerJP3":"おまいり","AnswerJP4":"おべんり","CorrectAnswer":"おたより","UnderlineText":"お便り"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"親友で優しい大家さんにめぐり会えて、本当にラッキーでした。","AnswerJP1":"たいか","AnswerJP2":"おおいえ","AnswerJP3":"だいか","AnswerJP4":"おおや","CorrectAnswer":"おおや","UnderlineText":"大家"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"小学生までは、男の子のほうが発達が早い。","AnswerJP1":"はつたつ","AnswerJP2":"はったつ","AnswerJP3":"はつだつ","AnswerJP4":"はつっだつ","CorrectAnswer":"はったつ","UnderlineText":"発達"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"淡い期待だと知っていながら、待っている。","AnswerJP1":"あさい","AnswerJP2":"あおい","AnswerJP3":"あらい","AnswerJP4":"あわい","CorrectAnswer":"あわい","UnderlineText":"淡い"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"ともに白髪になるまで仲よく暮らす。","AnswerJP1":"しらが","AnswerJP2":"しぱつ","AnswerJP3":"しらがみ","AnswerJP4":"はっぱつ","CorrectAnswer":"しらが","UnderlineText":"白髪"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"さいわい人質は無事に救い出された。","AnswerJP1":"じんしつ","AnswerJP2":"にんじち","AnswerJP3":"ひとしつ","AnswerJP4":"ひとじち","CorrectAnswer":"ひとじち","UnderlineText":"人質"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"母に強引に塾へ連れて行かれた。","AnswerJP1":"きょういん","AnswerJP2":"ごういん","AnswerJP3":"つよひき","AnswerJP4":"つよびき","CorrectAnswer":"ごういん","UnderlineText":"強引"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"あなたは、この本を読んで、どのような感想をおもちになりましたか。","AnswerJP1":"かんそう","AnswerJP2":"かんそ","AnswerJP3":"かんそく","AnswerJP4":"かんせい","CorrectAnswer":"かんそう","UnderlineText":"感想"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"物価が上がりそうな気配が濃い。","AnswerJP1":"きはい","AnswerJP2":"きっぱい","AnswerJP3":"けはい","AnswerJP4":"けっぱい","CorrectAnswer":"けはい","UnderlineText":"気配"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"雲は大気中の水分が冷えて水の粒となったものである。","AnswerJP1":"すいふん","AnswerJP2":"みずふん","AnswerJP3":"みずぶん","AnswerJP4":"すいぶん","CorrectAnswer":"すいぶん","UnderlineText":"水分"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"舞台の歌手をライトでてらした。","AnswerJP1":"照らした","AnswerJP2":"明らした","AnswerJP3":"光らした","AnswerJP4":"映らした","CorrectAnswer":"照らした","UnderlineText":"てらした"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"秋から冬にかけてかんそう肌に悩む女性が多い。","AnswerJP1":"干燥","AnswerJP2":"乾燥","AnswerJP3":"干躁","AnswerJP4":"乾躁","CorrectAnswer":"乾燥","UnderlineText":"かんそう"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"彼の話は冗談じゃないかと、うたがっている。","AnswerJP1":"質って","AnswerJP2":"問って","AnswerJP3":"疑って","AnswerJP4":"儀って","CorrectAnswer":"疑って","UnderlineText":"うたがって"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"最近環境にやさしい素材がもちいられるようになった。","AnswerJP1":"使い","AnswerJP2":"取い","AnswerJP3":"行い","AnswerJP4":"用い","CorrectAnswer":"用い","UnderlineText":"もちい"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"バザーの売り上げは、全額きふしました。","AnswerJP1":"奇付","AnswerJP2":"奇符","AnswerJP3":"寄付","AnswerJP4":"遺符","CorrectAnswer":"寄付","UnderlineText":"きふ"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"あのころはまだ、将来のことをしんけんに考えていなかった。","AnswerJP1":"真剣","AnswerJP2":"真検","AnswerJP3":"信剣","AnswerJP4":"信検","CorrectAnswer":"真剣","UnderlineText":"しんけん"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"今度の展覧会はおかげさまで無事しゅうりょうしました。","AnswerJP1":"収了","AnswerJP2":"修了","AnswerJP3":"終了","AnswerJP4":"習了","CorrectAnswer":"終了","UnderlineText":"しゅうりょう"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"ただし、未成年はこの法のてきようから除く。","AnswerJP1":"敵用","AnswerJP2":"適用","AnswerJP3":"摘要","AnswerJP4":"滴要","CorrectAnswer":"適用","UnderlineText":"てきよう"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"メーカーから製品をおろして、ネットで販売する。","AnswerJP1":"下して","AnswerJP2":"降して","AnswerJP3":"堕して","AnswerJP4":"落して","CorrectAnswer":"下して","UnderlineText":"おろして"},{"Description":"N2","TopicKindTitle":"Hán tự","TopicTitle":"Đề 45","JapaneseContent":"そんなにせめたらかわいそうだよ。","AnswerJP1":"疑めたら","AnswerJP2":"怒めたら","AnswerJP3":"憎めたら","AnswerJP4":"責めたら","CorrectAnswer":"責めたら","UnderlineText":"せめたら"}
]
changedQue =[];
changedRadio = [];


$(document).ready(function(){
  
  $(".btn-submit").click(function(){
    var index;
    var numOFCrrectAns = 0;
    // fill color correct answer
    que.forEach((element,count) => {
      var classRadio;
      var classText;
      var userAnswer = [];
      var ansCorrect = [];
      for(index = 1; index <= 4; index++){
        classRadio = "#check" + (count+1) + index;
        if($(classRadio).prop("checked")){
          changedRadio[count] = classRadio;
          classText = ".text" + (count+1) + index;
          var tmpUserAnswer = $(classText).html();
          userAnswer = tmpUserAnswer.split(" ");
          break;
        }
      }
      if(userAnswer.length > 0){
        if(userAnswer[userAnswer.length - 1] != element.CorrectAnswer){
          $(classText).css("color","red");
          $(classText).css("font-weight","bold");
          changedQue.push(classText);
        }
        for (let index = 1; index <= 4; index++) {
          classText = ".text" + (count+1) + index;
          let tmpAns = $(classText).html();
          ansCorrect = tmpAns.split(" ");
          if(ansCorrect[ansCorrect.length-1] === element.CorrectAnswer){
            break;
          }
        }
        $(classText).css("color", "green");
        $(classText).css("font-weight","bold");
        if(userAnswer[userAnswer.length - 1] != element.CorrectAnswer){
          changedQue.push(classText);
        }else{
          changedQue.push(classText);
          numOFCrrectAns = numOFCrrectAns + 1;
        }
      } 
    });
    $(window).scrollTop(0);
    if(changedRadio.length != 0){
      $(".result").text("Kết quả:");
      $(".result").append(numOFCrrectAns+"/"+que.length);
    }
  });
  //==================================================
  $(".btn-reset").click(function(){
    var index;
    // reset radio button and color
    if((changedQue.length == 0) && (changedRadio.length == 0)){
      que.forEach((element,count) => {
        var classRadio;
        for(index = 1; index <= 4; index++){
          classRadio = "#check" + (count+1) + index;
          if($(classRadio).prop("checked")){
            $(classRadio).prop("checked",false);
            break;
          }
        }
      });
    }else{ 
      for (index = 0; index < changedQue.length; index++) {
        $(changedQue[index]).css("color", "black");
        $(changedQue[index]).css("font-weight","unset");
        
      }
      for (index = 0; index < changedRadio.length; index++) {
        $(changedRadio[index]).prop("checked",false);
      }
    }
    $(window).scrollTop(0);
    $(".result").text("Kết quả:");
  });
  //==================================================
  $(".btn-start").click(function(){
    $(".btn-start").remove();
    for (var i = 0; i < que.length; i++){
      var question = $("<h5></h5>").text(que[i].JapaneseContent);
      $(".body-kanji").append(question);
      $("<div>").addClass('card my-4' + ' queskanji' + i).appendTo(".body-kanji");
      $("<h5>").html(que[i].UnderlineText).addClass('card-header style-kanji').appendTo(".queskanji" +i);
      $("<div>").addClass('card-body' + ' anskanji'+i).appendTo(".queskanji" +i);
      //==============1================
      var name = "optradio" + (i + 1);
      var id1 = "check" + (i + 1) + "1";
      var label1 = "text" +(i + 1) + "1";
      $("<div>").addClass('form-check ans'+ i + 1).appendTo(".anskanji" +i);
      $(".ans"+i + 1).append("<input type='radio' class='form-check-input' name='name' id='1'></input>");
      $("#1").attr("name",name);
      $("#1").attr("id",id1);
      $("<label>").html("1 " + que[i].AnswerJP1).addClass('form-check-label '+ label1).appendTo(".ans"+i + 1);
      //==============2================
      var id2 = "check" + (i + 1) + "2";
      var label2 = "text" +(i + 1) + "2";
      $("<div>").addClass('form-check ans'+i + 2).appendTo(".anskanji" +i);
      $(".ans"+i + 2).append("<input type='radio' class='form-check-input' name='name' id='2'></input>");
      $("#2").attr("name",name);
      $("#2").attr("id",id2);
      $("<label>").html("2 " + que[i].AnswerJP2).addClass('form-check-label '+ label2).appendTo(".ans"+i + 2);
      //==============3================
      var id3 = "check" + (i + 1) + "3";
      var label3 = "text" +(i + 1) + "3";
      $("<div>").addClass('form-check ans'+i + 3).appendTo(".anskanji" +i);
      $(".ans"+i + 3).append("<input type='radio' class='form-check-input' name='name' id='3'></input>");
      $("#3").attr("name",name);
      $("#3").attr("id",id3);
      $("<label>").html("3 " + que[i].AnswerJP3).addClass('form-check-label '+ label3).appendTo(".ans"+i + 3);
      //==============4================
      var id4 = "check" + (i + 1) + "4";
      var label4 = "text" +(i + 1) + "4";
      $("<div>").addClass('form-check ans'+i + 4).appendTo(".anskanji" +i);
      $(".ans"+i + 4).append("<input type='radio' class='form-check-input' name='name' id='4'></input>");
      $("#4").attr("name",name);
      $("#4").attr("id",id4);
      $("<label>").html("4 " + que[i].AnswerJP4).addClass('form-check-label '+ label4).appendTo(".ans"+i + 4);      
    }
    // $(".body-kanji").append('<button type="button" class="btn btn-info btn-submit">Kết quả</button>');
    // $(".body-kanji").append('<button type="button" class="btn btn-info btn-reset">Làm lại</button>');
    $(".btn-submit").attr("disabled", false);
    $(".btn-reset").attr("disabled", false);
  })
});
